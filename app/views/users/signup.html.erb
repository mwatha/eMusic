<script>

  function setAttributes() {
    try {
      var scroller = document.getElementsByClassName("scroller")[0]
      var tos = document.getElementsByClassName("tos")[0]
      tos.style.height = "105px";
      scroller.style.height = "79px";
      tos.style.display = "block";
    }catch(e) {}
  }

  function showAll() {
    var scroller = document.getElementsByClassName("scroller")[0]
    var tos = document.getElementsByClassName("tos")[0]
    tos.style.height = "auto";
    scroller.style.height = "400px";
  }

  function submitForm() {
    form = document.getElementById("customer");
    form.submit();
  }

  function updateDOB() {
    try {
      var dob = document.getElementsByClassName("span2")[0].value;
      document.getElementById("dob_disabled").value = dob;
      document.getElementById("user_birtdate").value = dob;
    }catch(e) {}
  }

  function checkBox(element) {
    if(element.checked) {                                                       
      document.getElementById("signup").disabled = false;                          
    }else{                                                                      
      document.getElementById("signup").disabled = true;                           
    }
  }

  function validateForm(){                                                      
    fname = document.getElementById('user_first_name');                    
    lname = document.getElementById('user_last_name');                        
    sex = document.getElementById('user_gender');               
    dob = document.getElementById('user_dob');                           
    email = document.getElementById('user_email');                          
    username = document.getElementById('user_username');                             
    password = document.getElementById('user_password');               
    password2 = document.getElementById('user_retype_password');               
                                                                                
    if(fname.value == '') {                                                     
      alert("Please enter first name ...");                                   
      return false;                                                             
    }else if(lname.value == '') {                                   
      alert("Please enter last name...");                                    
      return false;                                                             
    }else if(sex.value == 'Select sex') {                                         
      alert("Please select sex ...");                        
      return false;                                                             
    }else if(dob.value == '') {                                                 
      alert("Please enter birthdate ...");                                     
      return false;                                                             
    }else if(email.value == '') {                                               
      alert("Please enter your email address ...");                             
      return false;                                                             
    }else if(username.value == '') {                                                 
      alert("Please enter username ...");                                       
      return false;                                                             
    }else if(password.value == '') {                                             
      alert("Please enter password ...");                                
      return false;                                                             
    }else if(password.value != password2.value) {                                             
      alert("The two passwords do not match ...");                                
      return false;                                                             
    } 


    if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
      xmlhttp=new XMLHttpRequest();                                             
    }else{// code for IE6, IE5                                                  
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");                           
    }                                                                           
    xmlhttp.onreadystatechange=function() {                                     
      if (xmlhttp.readyState==4 && xmlhttp.status==200) {                       
        var results = xmlhttp.responseText;                                     
        if(results == 'undefined' || results == '' || results == '"not validate"') {                           
          alert("The username is not available, please try another one")      
          return false;                                                               
        }else{ 
          document.getElementById('customer').submit();                                                           
          return true;                                                               
        }                                                                       
      }                                                                         
    }                                                                           
    xmlhttp.open("GET","/users/validate_username?username="+username.value,true);           
    xmlhttp.send();      
                                                                          
    return false;                                                                
   }
</script>

<style>


.front-card {
  height: auto;
  margin: -154px 0px 0px -418px;
  top: 205px;
  width: 838px;
  left: 50%;
  position: absolute;
  color: #333333;
  vertical-align: baseline;
  padding: 0px;
  font: inherit;
  border-style: solid;
  border-color: black;
  border-width: 1px;
  border-radius: 14px 14px 14px 14px;
}

.front-random-image-city-balcony .front-welcome {
  border-radius: 6px 6px 6px 6px;
}

.front-welcome {
  box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 125px rgba(255, 255, 255, 0.35);
  display: block;
  height: 328px;
  left: 0px;
  position: absolute;
  top: 0px;
  width: 520px;
  font: inherit;
  margin: 0px;
  padding: 0px;
  vertical-align: baseline;
  background: url("/images/welcome-1.jpg");
}

.signin, .signup {
  background: -moz-linear-gradient(center top , #FFFFFF 0pt, #DDDDDD 100%) repeat scroll 0 0 transparent;
  border-bottom: 1px solid #CCCCCC;
  border-left: 1px solid #EEEEEE;
  border-right: 1px solid #EEEEEE;
  box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
}

.front-card .text-input {
  height: 20px;
  border: 1px solid #CCCCCC;
  box-shadow: 0 1px 0 #EEEEEE inset, 0 1px 0 #FFFFFF; 
}

input, textarea {
  -moz-transition: background 0.2s linear 0s;
}

input, textarea, select {
  background-color: #FFFFFF;
  border-radius: 3px 3px 3px 3px;
  display: inline-block;
  margin: 0px;
  outline: medium none;
  padding: 4px;
}

label, input, textarea, select, button {
  font: 13px/20px "HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;
}

.user-details {
   width: 40%; 
   position: relative;
   left: 35%;
   background-color: transparent;
   margin-bottom: 50px;
}

.user-details th {
  text-align: left;
  font: 13px/20px "HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;
}

.tos {
  background: none repeat scroll 0 0 #F4F4F4;
  border-bottom: 1px solid #DDDDDD;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
  clear: both;
  margin: 0;
  padding: 8px 0 10px;
  text-shadow: 0 1px 0 #FFFFFF;
  width: 392px;
  display: none;
}

.scroller {
  color: #888888;
  height: 68px;
  outline: medium none;
  overflow-y: scroll;
  padding: 0 10px;
}

.scroller p{
  color: #999999;
  font-size: 12px;
  line-height: 18px;
}

.scroller h3{
  font-size: 13px;
  margin: 15px 0 0;
  line-height: 1;
  color: #333333;
  text-rendering: optimizelegibility;
}

h1 {
  clear: both;
  padding: 40px 0 20px;
  font-size: 24px;
  font-weight: bold;
  line-height: 1;
  color: #333333;
  text-align: center;
}

#dob_disabled {
  width: 159px;
}

.span2 {
  visibility:hidden;                                                          
  position: absolute;                                                         
  bottom: 0px;
}

.input-prepend .add-on, .input-append .add-on {
  position: absolute;
  top: 123px;
  left: 230px;
  height: 13px;
}

.signup_btn {
  width: 100%;
}



</style>

<body onload="setAttributes();"> 

<div class="row-fluid">
      
    <div class="front-card">

<div class="front-card">
 <h1>Join eMusic today.</h1>   
 <form action="/users/create" method="post" id = "customer" onSubmit="return validateForm();">
 <table class="user-details">                               
  <tbody>                                                                 
    <tr>                                                                  
      <td>&nbsp;</td>                                                     
    </tr>                                                                 
    <tr>                                                                  
      <td><%=text_field(:user, :first_name,:placeholder => "First name") %> </td>
    </tr>                                                                 
    <tr>                                                                  
      <td><%=text_field(:user, :last_name ,:placeholder => "Last name") %> </td>
    </tr>                                                                 
    <tr>                                                                  
      <td><%= select_tag "user[gender]", options_for_select(["Select sex","Female", "Male"]),:placeholder => "Sex" %></td>
    </tr>                                                                 
    <!--tr>                                                                  
      <td>
        <font style="color: #999999;font-size:12px;">Birthdate:</font>
        <input id="dob_disabled" type="text" size="10" name="user[dob]" disabled="disabled" placeholder = "Birthdate">
        <div class="input-append date" id="dp3" data-date="<%#=Date.today - 20.year%>" data-date-format="yyyy-mm-dd">
          <input class="span2" size="16" type="text" value="<%#=Date.today - 20.year%>" style="width: auto;">
          <span class="add-on"><i class="icon-th"></i></span>
        </div>
      </td>
    </tr-->                                                                 
    <tr>                                                                  
      <td><%=text_field(:user, :dob ,:placeholder => "Birthdate") %> </td>
    </tr>                                                                 
    <tr>                                                                  
      <td><%=text_field(:user, :email,:placeholder => "Email") %></td>
    </tr>                                                                 
    <tr>                                                                  
      <td><%=text_field(:user, :username, :textCase => "lower",:placeholder => "Username") %> </td>
    </tr>                                                                 
    <tr>                                                                  
      <td><%=password_field(:user, :password,:placeholder => "Password") %></td>
    </tr>                                                                 
    <tr>                                                                  
      <td><%=password_field(:user, :retype_password,:placeholder => "Retype-password") %> </td>
    </tr>                                                                 
    <tr>                                                                  
      <td>
        <div class="tos" onclick="showAll();">
          <p>By clicking the check box, you agree to the terms below:
             <%=check_box_tag(:female, 
                value = "0", checked = false, 
                options = {:onchange => "checkBox(this);"})%>
          </p>
          <div class="scroller" style="height: 400px;" mouseover="showAll();">
            <%=@terms_of_condtion%>
          </div>
        </div>
      </td>                                                     
    </tr>                                                                 
    <tr>                                                                  
      <td style="float:right;position:absolute;width:99%;">              
        <input type="submit" id="signup" disabled="disabled" 
          class="btn signup_btn" value="Sign up for eMusic" style="width:100%;" />
      </td>                                                               
    </tr>                                                                 
  </tbody>                                                                
 </table>
 <%= hidden_field_tag("user[birtdate]", nil) %>
 </form>
</div>
</div>
</div>
<body>

<script>
  setInterval("updateDOB();",300);
</script>
